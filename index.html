<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>مولد بوت واتساب</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/codemirror.min.css">
    <style>
        body { font-family: Arial; direction: rtl; text-align: right; background-color: #f0f0f0; margin:0; }
        header { background: #4CAF50; color:white; padding:15px; font-size:24px; }
        #editor { height: 400px; border:1px solid #ccc; margin:20px; }
        #runBtn { margin:20px; padding:10px 20px; font-size:18px; background:#4CAF50; color:white; border:none; cursor:pointer; }
        #qrCode { margin:20px; text-align:center; }
    </style>
</head>
<body>
    <header>مولد بوت واتساب - ادخل كود البوت</header>
    <div id="editor"></div>
    <button id="runBtn">تشغيل البوت</button>
    <div id="qrCode">
        <h3>QR Code سيظهر هنا بعد التشغيل</h3>
        <img id="qrImage" src="" alt="QR Code">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/mode/javascript/javascript.min.js"></script>
    <script>
        const editor = CodeMirror(document.getElementById('editor'), {
            mode: "javascript",
            lineNumbers: true,
            value: "// اكتب كود البوت هنا\n"
        });

        const runBtn = document.getElementById('runBtn');
        const qrImage = document.getElementById('qrImage');

        runBtn.addEventListener('click', async () => {
            const code = editor.getValue();
            try {
                const response = await fetch('/run-bot', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code })
                });
                const data = await response.json();
                if(data.qr) qrImage.src = data.qr;
                else alert('حدث خطأ أثناء تشغيل البوت');
            } catch(err) {
                console.error(err);
                alert('خطأ في الاتصال بالسيرفر');
            }
        });
    </script>
</body>
</html>
